(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{180:()=>{},14698:()=>{},19212:()=>{},27843:()=>{},30841:()=>{},31668:()=>{},42993:()=>{},45755:()=>{},67926:()=>{},68996:(e,t,r)=>{"use strict";r.d(t,{m:()=>E,y:()=>v});var a=r(95155),n=r(12115),s=r(83718),o=r(21550),i=r(8773),l=r(79402),c=r(30840),u=r(67634),d=r(26432),p=r(2184),h=r(76046),m=r(19727),f=r(43425),g=r(93552),y=r(83722),w=r(96817);m.E.configure({Auth:{Cognito:{mandatorySignIn:!0,userPoolId:"eu-west-1_eyDmaqzdy",userPoolClientId:"2b2gjm8b43s6admu7k6tv9h861",identityPoolId:"eu-west-1:d0f61e5e-9b11-4739-9688-aafe68705fe2",region:"us-east-1",loginWith:{email:!0}}},Storage:{S3:{bucket:"batch-data-input",region:"eu-west-1",level:"private",identityPoolId:"eu-west-1:d0f61e5e-9b11-4739-9688-aafe68705fe2",useAccelerateEndpoint:!0,customEndpoint:"https://batch-data-input.s3-accelerate.amazonaws.com"}}});let I=(0,n.createContext)(null);function v(e){let{children:t}=e,[r,m]=(0,n.useState)({user:null,identityId:null,isAuthenticated:!1,session:null}),[v,E]=(0,n.useState)(!0),[b,S]=(0,n.useState)(null),k=(0,h.useRouter)();(0,n.useEffect)(()=>{T();let e=e=>{let{payload:t}=e;switch(console.log("Auth event: ".concat(t.event)),t.event){case"signIn":console.log("User signed in"),T();break;case"signOut":console.log("User signed out"),L();break;case"tokenRefresh":console.log("Token refreshed"),T();break;case"tokenRefresh_failure":console.log("Token refresh failed"),L()}};return f.YZ.listen("auth",e),()=>f.YZ.remove("auth",e)},[k]);let C=async e=>{try{let t="".concat(e,".uploadstate"),r=await (0,c.p)({path:t});if(r&&r.items&&r.items.length>0){let{url:e}=await (0,u.I)({path:t}),r=await fetch(e);if(r.ok){let e=await r.json();return{resumable:!0,uploadState:e}}}return{resumable:!1}}catch(e){return console.error("Error checking resumable upload:",e),{resumable:!1}}},U=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;try{try{return await (0,d.C)({path:"".concat(e,".uploadstate"),data:new Blob([JSON.stringify(t)],{type:"application/json"}),options:{accessLevel:"private"}}).result,!0}catch(a){if(503===a.statusCode&&r<5){let a=Math.min(1e3*Math.pow(2,r)+1e3*Math.random(),3e4);return console.log("Rate limited when saving upload state. Retrying in ".concat(a,"ms (attempt ").concat(r,"/").concat(5,")")),await new Promise(e=>setTimeout(e,a)),U(e,t,r+1)}throw a}}catch(e){return console.error("Error saving upload state:",e),!1}},x=async e=>{try{return await (0,p.T)({path:"".concat(e,".uploadstate")}),!0}catch(e){return console.error("Error clearing upload state:",e),!1}},j=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];try{if(!r.identityId)throw Error("User not authenticated");let o=null;if(!s){let e=await C(t);e.resumable&&(o=e.uploadState,console.log("Resuming upload for ".concat(t)))}let{partSize:i,maxConcurrentParts:l}=J(e.size),c=(null==o?void 0:o.uploadId)||"upload_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,10)),u=o||{uploadId:c,filePath:t,fileName:e.name,fileSize:e.size,contentType:e.type||"application/octet-stream",partSize:i,partsCompleted:[],startedAt:new Date().toISOString(),lastUpdated:new Date().toISOString(),progress:0};o||await U(t,u);let p=async(e,r)=>{a&&a(r),u.progress=r,u.lastUpdated=new Date().toISOString(),100!==r||u.partsCompleted.includes(e)||u.partsCompleted.push(e),r%5==0&&await U(t,u)},h={accessLevel:"private",contentType:e.type||"application/octet-stream",multipartUpload:e.size>5242880,partSize:i,queueSize:l,accelerate:!0,abortSignal:n,onProgress:async e=>{let t;if("number"==typeof e)t=e;else if(!e||"object"!=typeof e)return;else if("transferredBytes"in e&&"totalBytes"in e)t=e.totalBytes>0?Math.round(e.transferredBytes/e.totalBytes*100):0;else{if(!("loaded"in e)||!("total"in e))return;t=e.total>0?Math.round(e.loaded/e.total*100):0}let r=e.partNumber||1;await p(r,t)}},m=await (0,d.C)({path:t,data:e,options:h}).result;return u.progress=100,u.status="completed",u.completedAt=new Date().toISOString(),await U(t,u),s||await x(t),{key:t,result:m,uploadState:u}}catch(t){if("AbortError"===t.name||t.message&&t.message.includes("aborted"))throw console.log("Upload of ".concat(e.name," was aborted")),Error("Upload aborted");throw console.error("Error uploading file:",t),t}},N=async e=>{try{let t=(await (0,c.p)({path:e,options:{pageSize:1e3,recursive:!0}})).items.filter(e=>(e.key||e.path||"").endsWith(".uploadstate")).map(e=>(e.key||e.path||"").replace(".uploadstate",""));return{hasIncompleteUploads:t.length>0,incompleteUploads:t}}catch(e){return console.error("Error checking project uploads:",e),{hasIncompleteUploads:!1,incompleteUploads:[]}}},P=async e=>{try{E(!0);let t=await (0,g.x)({username:e});return E(!1),{success:!0,delivery:t.delivery}}catch(e){if(console.error("Error initiating password reset:",e),E(!1),"UserNotFoundException"===e.name)return{success:!1,message:"No account found with this email."};if("LimitExceededException"===e.name)return{success:!1,message:"Too many attempts. Please try again later."};return{success:!1,message:e.message||"Failed to initiate password reset."}}},A=async(e,t,r)=>{try{return E(!0),await (0,y.P)({username:e,confirmationCode:t,newPassword:r}),E(!1),{success:!0}}catch(e){if(console.error("Error completing password reset:",e),E(!1),"CodeMismatchException"===e.name)return{success:!1,message:"Invalid verification code."};if("ExpiredCodeException"===e.name)return{success:!1,message:"Verification code has expired. Please request a new one."};if("InvalidPasswordException"===e.name)return{success:!1,message:e.message||"Password does not meet requirements."};else return{success:!1,message:e.message||"Failed to reset password."}}},z=async e=>{try{return await (0,s.J)({username:e,password:"DummyPassword123!"}),!0}catch(e){if(console.log("Sign in check error:",e),"UserNotFoundException"===e.name)return!1;if("NotAuthorizedException"===e.name&&e.message.includes("Incorrect username or password"))return!0;return!1}},B=e=>{if(!e)return{firstName:"",lastName:""};let t=e.split(" ");return 1===t.length?{firstName:t[0],lastName:""}:{firstName:t[0],lastName:t.slice(1).join(" ")}},D=async(e,t)=>{if(!e||!t.user)return null;let r=t.user;try{let a="clients/".concat(e,"/user-preferences.json");if((await (0,c.p)({path:"clients/".concat(e,"/"),options:{accessLevel:"private"}})).items.some(e=>{let t=e.key||e.path||"";return t===a||t.endsWith("/user-preferences.json")}))try{let{url:e}=await (0,u.I)({path:a}),t=await fetch(e);if(t.ok){let e=await t.json();return console.log("User preferences loaded for ".concat(r.username)),S(e),e}}catch(e){console.error("Error getting existing preferences:",e)}console.log("Creating preferences for user: ".concat(r.username));let n=(0,w.I)(r.username),{firstName:s,lastName:o}=B(n),i=t.session.tokens.idToken.payload.email||"",l={firstName:s,lastName:o,email:i,company:"",jobTitle:"",theme:"light",notifications:{emailNotifications:!0,projectCompletions:!0,newMessages:!0,systemUpdates:!1,marketingEmails:!1},compactView:!1,sessionTimeout:"30",profilePicture:null,created:new Date().toISOString(),lastUpdated:new Date().toISOString()};return await (0,d.C)({path:a,data:new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),options:{accessLevel:"private"}}).result,console.log("Preferences created for ".concat(r.username)),S(l),l}catch(e){return console.error("Error ensuring user preferences:",e),null}},O=async e=>{if(!r.identityId||!r.user)throw Error("User not authenticated");try{let t="clients/".concat(r.identityId,"/user-preferences.json"),a={...b||{},...e,lastUpdated:new Date().toISOString()};if(await (0,d.C)({path:t,data:new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),options:{accessLevel:"private"}}).result,S(a),e.theme){let t=new CustomEvent("themeChange",{detail:{theme:e.theme}});window.dispatchEvent(t),localStorage.setItem("theme",e.theme)}return a}catch(e){throw console.error("Error updating user preferences:",e),e}},M=async()=>{if(!r.identityId||!r.user)throw Error("User not authenticated");if(b)return b;try{let e="clients/".concat(r.identityId,"/user-preferences.json");try{let{url:t}=await (0,u.I)({path:e}),r=await fetch(t);if(r.ok){let e=await r.json();return S(e),e}}catch(e){console.log("Preferences not found, creating new ones")}return await D(r.identityId,r)}catch(e){return console.error("Error getting user preferences:",e),await D(r.identityId,r)}},T=async()=>{try{E(!0);let e=await (0,o.$)();if(!e||!e.tokens){console.log("No valid session found"),L();return}let t=await (0,i.H)();console.log("Current authenticated user details:",{username:t.username,userId:t.userId,signInDetails:t.signInDetails,attributes:t.attributes,...t});let r={user:t,identityId:e.identityId,isAuthenticated:!0,session:e};m(r),await _(e.identityId,r),await D(e.identityId,r),console.log("Session active for user: ".concat(t.username))}catch(e){console.error("Session check failed:",e),L()}finally{E(!1)}},L=()=>{m({user:null,identityId:null,isAuthenticated:!1,session:null}),S(null)},_=async(e,t)=>{if(e&&t)try{let r=await (0,c.p)({path:"clients/".concat(e,"/")});r.items&&0!==r.items.length?console.log("User folder exists for ".concat(t.username," (").concat(e,")")):await F(e,t)}catch(r){console.error("Error checking user folder:",r),await F(e,t)}},F=async(e,t)=>{try{return console.log("Creating folder for user: ".concat(t.username," (").concat(e,")")),await (0,d.C)({path:"clients/".concat(e,"/user-folder.json"),data:new Blob([JSON.stringify({created:new Date().toISOString(),username:t.username,userId:t.userId})],{type:"application/json"}),options:{accessLevel:"private"}}).result,console.log("Folder created for ".concat(t.username)),!0}catch(e){return console.error("Error creating user folder:",e),!1}},R=async()=>{try{await (0,l.C)({global:!0}),L(),k.push("/login")}catch(e){console.error("Error signing out:",e),L(),k.push("/login")}},q=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{if(!r.identityId)throw Error("User not authenticated");let o=s.isPaused||!1,i=s.isCancelled||!1,l=t||"clients/".concat(r.identityId,"/uploads/").concat(Date.now(),"-").concat(e.name),{partSize:c,maxConcurrentParts:u}=J(e.size),p={accessLevel:"private",contentType:e.type||"application/octet-stream",multipartUpload:e.size>5242880,partSize:c,queueSize:u,accelerate:!0,abortSignal:n,onProgress:e=>{if(!i&&!o&&a){let t;if("number"==typeof e)t=e;else if(e&&"object"==typeof e){if("transferredBytes"in e&&"totalBytes"in e)t=e.totalBytes>0?Math.round(e.transferredBytes/e.totalBytes*100):0;else if("loaded"in e&&"total"in e)t=e.total>0?Math.round(e.loaded/e.total*100):0;else{console.warn("Unrecognized progress format:",e);return}}else{console.warn("Invalid progress format:",e);return}a(t)}}},h=await (0,d.C)({path:l,data:e,options:p}).result;return{key:l,result:h}}catch(t){if("AbortError"===t.name||t.message&&t.message.includes("aborted"))throw console.log("Upload of ".concat(e.name," was aborted")),Error("Upload aborted");throw console.error("Error uploading file:",t),t}},J=e=>{let t=5242880,r=4;return e>0x140000000?(t=0x6400000,r=10):e>0x40000000?(t=0x3200000,r=8):e>0x6400000?(t=0x1900000,r=6):e>0x3200000&&(t=0xa00000,r=5),Math.ceil(e/t)>1e4&&(t=Math.ceil(e/9999)),{partSize:t,maxConcurrentParts:r}},W=async e=>{try{return await (0,p.T)({path:e}),!0}catch(e){return console.error("Error deleting file:",e),!1}},H=async e=>{try{let{url:t}=await (0,u.I)({path:e});return t}catch(e){return console.error("Error getting file URL:",e),null}},V=async e=>{try{return(await (0,c.p)({path:e})).items||[]}catch(e){return console.error("Error listing files:",e),[]}},Y=async()=>{try{E(!0);let e=await (0,o.$)();if(!e||!e.tokens)return console.log("No valid session found"),L(),!1;let t=await (0,i.H)(),r={user:t,identityId:e.identityId,isAuthenticated:!0,session:e};return m(r),_(e.identityId,r),D(e.identityId,r),console.log("Session active for user: ".concat(t.username)),!0}catch(e){return console.error("Session check failed:",e),L(),!1}finally{E(!1)}},Z={user:r.user,identityId:r.identityId,isAuthenticated:r.isAuthenticated,session:r.session,isLoading:v,signOut:R,checkAuthState:Y,checkSession:T,uploadFile:(e,t,r,a)=>q(e,t,r,a),deleteFile:W,getFileUrl:H,listFiles:V,createUserFolder:()=>F(r.identityId,r.user),checkEmailExists:z,initiatePasswordReset:P,completePasswordReset:A,userPreferences:b,ensureUserPreferences:()=>D(r.identityId,r),getUserPreferences:M,updateUserPreferences:O,uploadFileResumable:j,checkResumableUpload:C,saveUploadState:U,clearUploadState:x,checkProjectUploads:N};return(0,a.jsx)(I.Provider,{value:Z,children:t})}function E(){let e=(0,n.useContext)(I);if(!e)throw Error("useAmplify must be used within an AmplifyProvider");return e}},71660:()=>{},90670:()=>{},96817:(e,t,r)=>{"use strict";r.d(t,{I:()=>a});let a=e=>e&&e.includes("-")?e.split("-")[0].replace(/\./g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "):e}}]);